<div class="flex items-center justify-between mb-6">
  <div class="flex flex-col gap-1">
    <h1 class="font-custom text-3xl font-bold text-gray-600">Integration Settings</h1>
    <h3 class="text-gray-400">Configure Exigo integration for <%= @company.name %></h3>
  </div>
  <div class="flex gap-3">
    <%= link_to "← Back to Home", admin_home_index_path(dri: @dri), class: "px-4 py-2 bg-gray-100 hover:bg-gray-200 text-gray-700 font-medium rounded-md" %>
    <%= link_to "Edit Settings", edit_admin_integration_setting_path(dri: @dri), class: "px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white font-medium rounded-md" %>
  </div>
</div>

<!-- Company Info -->
<div class="bg-white rounded-lg p-6 border border-gray-200 mb-6">
  <h3 class="font-semibold text-gray-700 mb-4">Company Information</h3>
  <div class="grid grid-cols-2 gap-4 text-sm">
    <div>
      <span class="text-gray-500">Name:</span>
      <span class="text-gray-900 font-medium ml-2"><%= @company.name %></span>
    </div>
    <div>
      <span class="text-gray-500">Shop:</span>
      <span class="text-gray-900 font-medium ml-2"><%= @company.fluid_shop %></span>
    </div>
    <div>
      <span class="text-gray-500">Fluid Company ID:</span>
      <span class="text-gray-900 font-medium ml-2"><%= @company.fluid_company_id %></span>
    </div>
    <div>
      <span class="text-gray-500">UUID:</span>
      <span class="text-gray-900 font-mono text-xs ml-2"><%= @company.company_droplet_uuid %></span>
    </div>
  </div>
</div>

<!-- Integration Status -->
<div class="bg-white rounded-lg p-6 border border-gray-200 mb-6">
  <h3 class="font-semibold text-gray-700 mb-4">Integration Status</h3>
  <div class="flex items-center gap-4">
    <div>
      <span class="text-gray-500">Status:</span>
      <% if @integration_setting.enabled %>
        <span class="inline-flex items-center px-3 py-1 bg-green-100 text-green-800 text-sm font-medium rounded ml-2">
          ✓ Enabled
        </span>
      <% else %>
        <span class="inline-flex items-center px-3 py-1 bg-gray-100 text-gray-600 text-sm font-medium rounded ml-2">
          Disabled
        </span>
      <% end %>
    </div>
    <% if @integration_setting.persisted? %>
      <div>
        <span class="text-gray-500">Last Updated:</span>
        <span class="text-gray-700 ml-2"><%= time_ago_in_words(@integration_setting.updated_at) %> ago</span>
      </div>
    <% end %>
  </div>
</div>

<% if @integration_setting.persisted? && @integration_setting.enabled %>
  <!-- Exigo Configuration Summary -->
  <div class="grid grid-cols-2 gap-6">
    <!-- Database Configuration -->
    <div class="bg-white rounded-lg p-6 border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">Database Configuration</h3>
      <div class="space-y-2 text-sm">
        <div>
          <span class="text-gray-500">Host:</span>
          <span class="text-gray-900 ml-2"><%= @integration_setting.credentials["exigo_db_host"] || "-" %></span>
        </div>
        <div>
          <span class="text-gray-500">Database:</span>
          <span class="text-gray-900 ml-2"><%= @integration_setting.credentials["exigo_db_name"] || "-" %></span>
        </div>
        <div>
          <span class="text-gray-500">Username:</span>
          <span class="text-gray-900 ml-2"><%= @integration_setting.credentials["exigo_db_username"] || "-" %></span>
        </div>
        <div>
          <span class="text-gray-500">Password:</span>
          <span class="text-gray-900 ml-2">
            <% if @integration_setting.credentials["exigo_db_password"].present? %>
              ••••••••
            <% else %>
              -
            <% end %>
          </span>
        </div>
      </div>
    </div>

    <!-- API Configuration -->
    <div class="bg-white rounded-lg p-6 border border-gray-200">
      <h3 class="font-semibold text-gray-700 mb-4">API Configuration</h3>
      <div class="space-y-2 text-sm">
        <div>
          <span class="text-gray-500">Base URL:</span>
          <span class="text-gray-900 ml-2 break-all"><%= @integration_setting.credentials["api_base_url"] || "-" %></span>
        </div>
        <div>
          <span class="text-gray-500">Username:</span>
          <span class="text-gray-900 ml-2"><%= @integration_setting.credentials["api_username"] || "-" %></span>
        </div>
        <div>
          <span class="text-gray-500">Password:</span>
          <span class="text-gray-900 ml-2">
            <% if @integration_setting.credentials["api_password"].present? %>
              ••••••••
            <% else %>
              -
            <% end %>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Integration Settings -->
  <div class="bg-white rounded-lg p-6 border border-gray-200 mt-6">
    <h3 class="font-semibold text-gray-700 mb-4">Integration Settings</h3>
    <div class="grid grid-cols-3 gap-4 text-sm">
      <div>
        <span class="text-gray-500">Preferred Customer Type ID:</span>
        <span class="text-gray-900 font-medium ml-2"><%= @integration_setting.preferred_customer_type_id %></span>
      </div>
      <div>
        <span class="text-gray-500">Retail Customer Type ID:</span>
        <span class="text-gray-900 font-medium ml-2"><%= @integration_setting.retail_customer_type_id %></span>
      </div>
      <div>
        <span class="text-gray-500">API Delay:</span>
        <span class="text-gray-900 font-medium ml-2"><%= @integration_setting.api_delay_seconds %>s</span>
      </div>
      <div>
        <span class="text-gray-500">Snapshots to Keep:</span>
        <span class="text-gray-900 font-medium ml-2"><%= @integration_setting.snapshots_to_keep %></span>
      </div>
      <div>
        <span class="text-gray-500">Daily Warmup Limit:</span>
        <span class="text-gray-900 font-medium ml-2"><%= number_with_delimiter(@integration_setting.daily_warmup_limit) %></span>
      </div>
      <div>
        <span class="text-gray-500">New Customer Subscription Pricing:</span>
        <span class="text-gray-900 font-medium ml-2"><%= @integration_setting.new_customer_subscription_pricing? ? "Enabled" : "Disabled" %></span>
      </div>
    </div>
  </div>
<% else %>
  <!-- No Configuration Message -->
  <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-6 text-center">
    <svg class="w-12 h-12 text-yellow-400 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
    </svg>
    <h3 class="text-lg font-semibold text-yellow-900 mb-2">Integration Not Configured</h3>
    <p class="text-yellow-700 mb-4">No Exigo integration has been configured for this company yet.</p>
    <%= link_to "Configure Integration", edit_admin_integration_setting_path(dri: @dri), class: "inline-flex items-center px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white font-medium rounded-md" %>
  </div>
<% end %>
